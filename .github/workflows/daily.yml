name: Daily Commits (7-10 per day)

on:
  schedule:
    # Runs multiple times daily to make 7-10 commits
    # Spread throughout the day for natural pattern
    - cron: '0 2 * * *'   # 2:00 AM UTC - First batch
    - cron: '0 6 * * *'   # 6:00 AM UTC - Second batch
    - cron: '0 10 * * *'  # 10:00 AM UTC - Third batch
    - cron: '0 14 * * *'  # 2:00 PM UTC - Fourth batch
    - cron: '0 18 * * *'  # 6:00 PM UTC - Fifth batch
    - cron: '0 22 * * *'  # 10:00 PM UTC - Sixth batch
  workflow_dispatch: # Allows manual triggering

jobs:
  daily-commits:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
          persist-credentials: true
      
      - name: Configure Git with your credentials
        run: |
          # Use your GitHub email and username for commits to count on your graph
          git config --local user.email "${{ secrets.GIT_EMAIL || 'github-actions[bot]@users.noreply.github.com' }}"
          git config --local user.name "${{ secrets.GIT_NAME || 'github-actions[bot]' }}"
      
      - name: Check if commits already made today
        id: check_date
        run: |
          TODAY=$(date -u '+%Y-%m-%d')
          LAST_COMMIT_DATE=$(git log -1 --format=%cd --date=short 2>/dev/null || echo "")
          if [ "$LAST_COMMIT_DATE" = "$TODAY" ]; then
            COMMIT_COUNT=$(git log --since="midnight" --oneline | wc -l)
            echo "commits_today=$COMMIT_COUNT" >> $GITHUB_OUTPUT
            echo "already_committed=true" >> $GITHUB_OUTPUT
          else
            echo "commits_today=0" >> $GITHUB_OUTPUT
            echo "already_committed=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Make multiple commits
        if: steps.check_date.outputs.commits_today < 10
        run: |
          # Calculate how many commits to make (target: 7-10 total per day)
          COMMITS_TODAY=${{ steps.check_date.outputs.commits_today }}
          TARGET_TOTAL=$((RANDOM % 4 + 7))  # Random between 7-10
          REMAINING=$((TARGET_TOTAL - COMMITS_TODAY))
          
          # Make 1-2 commits per workflow run to spread them out
          if [ $REMAINING -gt 0 ]; then
            COMMITS_TO_MAKE=$((RANDOM % 2 + 1))  # 1 or 2 commits
            if [ $COMMITS_TO_MAKE -gt $REMAINING ]; then
              COMMITS_TO_MAKE=$REMAINING
            fi
            
            # Array of commit messages
            COMMIT_MESSAGES="Daily activity update|Code maintenance|Project progress|Documentation update|Code refactoring|Bug fixes|Feature development|Testing improvements|Performance optimization|Code review updates"
            
            for i in $(seq 1 $COMMITS_TO_MAKE); do
              # Select random message from array
              MESSAGE=$(echo "$COMMIT_MESSAGES" | tr '|' '\n' | shuf -n 1)
              TIMESTAMP=$(date -u '+%Y-%m-%d %H:%M:%S UTC')
              echo "" >> activity.log
              echo "$TIMESTAMP - $MESSAGE - Commit $i/$COMMITS_TO_MAKE" >> activity.log
              
              git add activity.log
              git commit -m "$MESSAGE - Commit $i/$COMMITS_TO_MAKE [skip ci]" || true
              
              # Small random delay between commits (if making multiple)
              if [ $i -lt $COMMITS_TO_MAKE ]; then
                sleep $((RANDOM % 60 + 30))  # 30-90 seconds
              fi
            done
            
            # Push all commits
            git push || true
          fi
      
      - name: Summary
        run: |
          COMMITS_TODAY=${{ steps.check_date.outputs.commits_today }}
          echo "✓ Commits made today: $COMMITS_TODAY"
          echo "✓ Target: 7-10 commits per day"

